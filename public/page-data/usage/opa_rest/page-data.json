{"componentChunkName":"component---node-modules-rocketseat-gatsby-theme-docs-core-src-templates-docs-query-js","path":"/usage/opa_rest/","result":{"data":{"mdx":{"id":"7d4a116a-1314-5b87-a1dc-c9b58d75275a","excerpt":"Start OPA as a service (listening on port  8181  by default) Create the access policy module Deposit access policy to the namespace  policies/:policyID \nHereâ€¦","fields":{"slug":"/usage/opa_rest/"},"frontmatter":{"title":"Data access control via OPA REST APIs","description":"Understanding the brewOPA workflow through OPA's REST APIs","image":null},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Data access control via OPA REST APIs\",\n  \"description\": \"Understanding the brewOPA workflow through OPA's REST APIs\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Start OPA as a service (listening on port \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"8181\"), \" by default)\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"opa run -s\\n\")), mdx(\"p\", null, \"Create the access policy module\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"curl localhost:8181/v1/policies/brewOPA \\\\\\n    -X PUT \\\\\\n    -H \\\"Content-Type: text/plain\\\" \\\\\\n    --data-binary @rego/brewOPA.rego\\n\")), mdx(\"p\", null, \"Deposit access policy to the namespace \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"policies/:policyID\"), \"\\nHere, we deposit JSON (generated from the YAML using \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://mikefarah.gitbook.io/yq/usage/convert#yaml-to-json\"\n  }), \"yq\"), \") because OPA's REST API doesn't support YAML.\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"curl localhost:8181/v1/data/policies/myPolicy \\\\\\n    -X PUT \\\\\\n    -H \\\"Content-Type: text/plain\\\" \\\\\\n    -d '{\\n  \\\"sensitiveAttrs\\\": [\\\"card_number\\\", \\\"credit_limit\\\", \\\"card_family\\\"],\\n  \\\"locations\\\": [\\n    {\\n      \\\"repo\\\": \\\"invoices\\\",\\n      \\\"schema\\\": \\\"finance\\\",\\n      \\\"table\\\": \\\"cards\\\"\\n    }\\n  ],\\n  \\\"rules\\\": [\\n    {\\n      \\\"deletes\\\": {\\n        \\\"allow\\\": true,\\n        \\\"rows\\\": 1\\n      },\\n      \\\"identities\\\": [\\\"bob\\\"],\\n      \\\"reads\\\": {\\n        \\\"allow\\\": true,\\n        \\\"attributes\\\": [\\\"credit_limit\\\", \\\"card_family\\\"],\\n        \\\"rows\\\": 10\\n      },\\n      \\\"updates\\\": {\\n        \\\"allow\\\": true,\\n        \\\"attributes\\\": [\\\"credit_limit\\\"],\\n        \\\"rows\\\": 1\\n      }\\n    }\\n  ],\\n  \\\"defaultRule\\\": {\\n    \\\"deletes\\\": {\\n      \\\"allow\\\": false\\n    },\\n    \\\"reads\\\": {\\n      \\\"allow\\\": true,\\n      \\\"attributes\\\": \\\"any\\\",\\n      \\\"rows\\\": 1\\n    },\\n    \\\"updates\\\": {\\n      \\\"allow\\\": false\\n    }\\n  }\\n}'\\n\")), mdx(\"p\", null, \"Query the access policy module providing data access parameters as input\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), \"curl -H \\\"Content-Type: application/json\\\" -X POST \\\\\\n$OPA_SERVER/v1/data/dbAccess/main\\\\?pretty\\\\=true \\\\\\n-d '{\\n    \\\"input\\\": {\\n        \\\"user\\\": \\\"bob\\\",\\n        \\\"repo\\\": \\\"clinics\\\",\\n        \\\"accessType\\\": \\\"SELECT\\\",\\n        \\\"tablesReferenced\\\": [\\\"finance.cards\\\"],\\n        \\\"columnsReferenced\\\": {\\n            \\\"finance.cards\\\": [\\\"Cust_ID\\\", \\\"Card_Number\\\", \\\"Credit_Limit\\\"]\\n        }\\n    }\\n}'\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"slug":"/usage/opa_rest/","prev":{"id":"db12969e-08e5-5aa6-bd93-f07d786c0b04","fields":{"slug":"/getting-started/"},"frontmatter":{"title":"Getting started"}},"next":{"id":"31af4369-ba39-54b5-9427-02efb6bdd1f3","fields":{"slug":"/usage/policies/"},"frontmatter":{"title":"Data Access Policies"}}}}}